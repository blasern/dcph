context("persistence")

test_that("persistent homology works", {
  # data
  df <- structure(list(x = c(-0.102908009117552, 0.199330135299561, -0.911338147540433, 
                             -0.137739093503527, 0.432936227041049, -0.911707650118624, -0.968197103116099, 
                             0.739225515714111, -0.0423011827505279, -0.193997365049578, 1.1175041333702, 
                             0.840015197762128, 0.0778296966194626, 0.737291616332103, 0.465023954648219, 
                             -0.356518226289902, -0.588965788383878, 1.04771872598099, 1.03671807044691, 
                             -0.56753273462932, -0.0854922354736487, 0.546206190250205, -0.441331665247924, 
                             -0.799444294326357, 0.943088728174086, -0.992030390715998, -0.0471217413219084, 
                             0.816839563248876, -0.828151844497528, 0.633346039130626, -0.651556525364044, 
                             0.670944792761396, -0.732147308011688, -0.674366881109038, -0.664681498677164, 
                             -0.354930485419389, -0.356899065853024, -0.935510157659976, -1.00324219421795, 
                             -1.02917343271304, -0.3415428488292, -0.858914947362098, 0.904505637321537, 
                             0.659508686237228, -0.801599727266248, 0.225855993648586, -0.93432159009905, 
                             0.723784514032932, -0.957850330155419, 1.01896707484371, 0.0781553235041156, 
                             0.856614960731326, -1.01661184979198, -0.705713463931746, -1.13822137510553, 
                             0.928807209198791, 0.0137577693349117, -0.895547528666509, -0.737307259171439, 
                             0.904598485794531, -1.226104395967, -0.40787174764572, -0.186870440801221, 
                             0.234347231965421, -0.272393483050968, 0.518499420420521, 0.753208649416911, 
                             0.0338944563395652, -0.738347224799616, 0.589254572694984, 0.968529568920462, 
                             0.719409408759021, -0.781276650564001, 0.440188769294201, -0.26322545322811, 
                             0.365533112310804, -0.0430389554620314, 0.418809742469867, -0.997216790996601, 
                             0.12226690406786, 0.928795197916397, -0.971993715138154, 0.816379869681794, 
                             -0.592036844474087, 1.0116591326895, 0.665484647788808, -0.480407866641817, 
                             0.545833847396896, 0.699224215500554, 0.184104534392662, 0.139838015530748, 
                             0.759929309350747, 1.10856058659791, -0.497803285240399, -1.1575821061731, 
                             -0.440881147640985, 0.708405783422886, 0.691612656611705, 0.833836643090048, 
                             0.86008155514192), 
                       y = c(0.931688587072382, 0.998665815331229, 
                             -0.0965391637334104, 1.15131807547918, 0.937845153207821, -0.106897930685983, 
                             -0.403058371473419, 0.778884979727489, 1.0567318117279, -0.949852602034994, 
                             -0.276397482990555, 0.611443286250406, -0.934641011728504, -0.250020101098962, 
                             -1.01064019360893, 0.929477392308305, -0.806153750062455, -0.316166066003055, 
                             -0.310167573968083, 0.894546838997884, 1.08854570234356, 0.929625424462877, 
                             0.905646154571406, -0.0509282121687383, -0.488252639467991, -0.0684211980608075, 
                             0.983292002689344, 0.245466447562563, 0.46991572242863, -0.827168579090689, 
                             0.930413943252558, 0.727585866249951, 0.736883664133764, -0.731093189251964, 
                             0.549317325578838, -0.890363769891668, -0.891806992418841, -0.336144680700236, 
                             0.474984981160056, 0.315058038017599, 0.922341825626573, -0.460689373200943, 
                             -0.57106900336217, 0.824305569361237, 0.47374104994661, 0.901385340856969, 
                             0.448652157883259, 0.79733869259546, 0.245315550475208, -0.381695105983121, 
                             -1.03686923206411, -0.384124059987747, 0.189441050425176, -0.537448134834599, 
                             0.107668058817139, 0.75671459971481, 0.963179601433402, 0.00835881658695077, 
                             0.757342548389112, -0.393539141868215, -0.186196780227437, 0.908739805832196, 
                             1.05251352234831, -0.975033152172398, -0.884687345475962, 0.877082228898757, 
                             0.322898995330471, -1.14605438294373, -0.696942543635999, 1.06513088272401, 
                             0.399140918758552, 0.587793378452342, 0.717970704673783, 0.792552651192866, 
                             0.83408731422255, 0.962041683083349, 0.954701183888271, 0.908195728990547, 
                             0.143116047002217, -0.933071253652148, 0.163827882366205, -0.168449479925085, 
                             -0.763557592724954, 0.606623089449232, 0.314424486180076, 0.790461142180324, 
                             0.996559111023577, 0.801345059823181, 0.765805717945362, 1.01006865915681, 
                             0.935352662397646, 0.823814574011432, -0.128993376906743, 0.947173484983895, 
                             -0.0505050740077351, -0.959395731511891, 0.50905764014339, 0.64055068708005, 
                             0.273478866142031, -0.409659215498206)), 
                  .Names = c("x", "y"), 
                  class = "data.frame", 
                  row.names = c(NA, 100L))
  pers <- structure(list(Dimension = c(0, 1, 0), 
                         Birth = c(1.43361784347283, 1.64060098040442, 1.43361784347283), 
                         Death = c(1.50560311999213, 2.24441236173205, 2.35217471640667)), 
                    .Names = c("Dimension", "Birth", "Death"), 
                    row.names = c(NA, -3L), 
                    class = "data.frame", 
                    max_diameter = 2.35217471640667, 
                    min_diameter = 1.43361784347283, 
                    max_dimension = 1)
  
  dc <- divisive_cover(distance_matrix = dist(df),
                       delta = 0.01, 
                       max_nodes = 7, 
                       relative_diameter = 0.1)
  
  expect_equal(persistent_homology(dc), pers)
})